<ion-view class="kickstarter-list" view-title="Kickstart Routes" hide-back-button="true">
  <ion-content scroll="false">
    <div class="item item-text-wrap" ng-if="error">
      <i class="icon ion-alert-circled"></i>
      There was a problem fetching the kickstarter from the server.
      Please try again later.
    </div>

    <ion-content class="list">
      <ion-refresher pulling-text="Pull to refresh..."
                     on-refresh="refreshRoutes()">
      </ion-refresher>

      <!-- recently bid kickstarter -->
      <div class="item item-divider"
          ng-if="data.backedKickstarter.length > 0">
        Kickstart routes you backed
      </div>

       <ion-item ng-repeat="route in data.backedKickstarter"
                 ui-sref="tabs.kickstarter-recap({
                   routeId: route.id
                  })"
                  class="item-icon-right">
        <route-item>
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route | routeStartTime | formatTime:true }}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route | routeEndTime | formatTime:true }}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>
          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_timeleft.svg">
              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft>1">
                {{route.daysLeft}} days left to activate
              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft==1">
                {{route.daysLeft}} day left to activate
              </span>
            </div>

            <!-- TODO: show price infor in progress -->
            <progress-bar cur-val={{route.notes.tier[0].no}} second-val={{route.notes.tier[1].no}}
              max-val={{route.notes.tier[1].pax}} high-price={{route.notes.tier[0].price}} low-price={{route.notes.tier[1].price}}
              high-total={{route.notes.tier[0].pax}}>
            </progress-bar>

            <div class="icon-and-schedule">
              <!-- <span class="icon ion-ios-flag-outline"></span> -->
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_activebid.svg">
              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft>1">
                You joined this route at ${{recentBidsById[route.id].bidPrice | number:2 }} per ride.

              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft==1">
                {{route.daysLeft}} day left to activate
              </span>
            </div>
          </route-item-additional-info>
        </route-item>

        <!-- <progress-bar cur-val=6 second-val=9 max-val=12></progress-bar> -->

      </ion-item>


      <!-- available kickstarter -->
      <div class="item item-divider"
          ng-if="data.kickstarter.length > 0">
        Kickstart Routes
      </div>

      <ion-item ng-repeat="route in data.kickstarter"
                ui-sref="tabs.kickstarter-detail({
                  routeId: route.id
                 })"
                 class="item-icon-right">
        <route-item>
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route | routeStartTime | formatTime:true }}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route | routeEndTime | formatTime:true }}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>
          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_timeleft.svg">
              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft>1">
                {{route.daysLeft}} days left to activate
              </span>
              <span class="mini-info" ng-if="route.daysLeft && route.daysLeft==1">
                {{route.daysLeft}} day left to activate
              </span>
            </div>
            <!-- TODO: show price infor in progress -->
            <progress-bar cur-val={{route.notes.tier[0].no}} second-val={{route.notes.tier[1].no}}
              max-val={{route.notes.tier[1].pax}} high-price={{route.notes.tier[0].price}} low-price={{route.notes.tier[1].price}}
              high-total={{route.notes.tier[0].pax}}>
            </progress-bar>
          </route-item-additional-info>
        </route-item>
      </ion-item>

    </ion-content>
  </ion-content>
</ion-view>
