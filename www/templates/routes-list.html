<ion-view class="routes-list" view-title="Routes">
  <ion-content scroll="false">
    <div class="item item-text-wrap" ng-if="error">
      <i class="icon ion-alert-circled"></i>
      There was a problem fetching the routes from the server.
      Please try again later.
    </div>

    <!-- Region Filter  -->
    <div class="region-filter">
      <label class="item item-input item-icon-left">
          <i class="ionicon ion-ios-search-strong"></i>
        <input type="text" ng-change="updateFilter(data.stagingFilterText)"
          placeholder="Search" ng-model="data.stagingFilterText" />
      </label>
      <label class="item item-input item-select">
        <select ng-model="data.selectedRegionId">
          <option value="" disabled selected>Select Region</option>
          <option value="">All Regions</option>
          <option ng-repeat="region in data.regions" value="{{region.id}}">{{region.name}}</option>
        </select>
      </label>
    </div>

    <ion-content class="list">
      <ion-refresher pulling-text="Pull to refresh..."
                     on-refresh="refreshRoutes(true)">
      </ion-refresher>

      <!-- Recent Routes Section -->
      <!-- ng-show doesn't work 100% reliably. angular bug? -->
      <div class="item item-divider">
        Your Activated Kickstarter Routes
      </div>
      <ion-item ng-repeat="route in data.filteredRecentRoutes"
                ui-sref="tabs.bookingPickup({
                  routeId: route.id,
                  boardStop:  data.recentRoutesById[route.id].boardStopStopId,
                  alightStop: data.recentRoutesById[route.id].alightStopStopId,
                  sessionId: data.nextSessionId
                })"
                class="item-icon-right">
        <route-item>
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route | routeStartTime | formatTime:true }}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route | routeEndTime | formatTime:true }}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>

          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_schedule.svg">
              </span>
              <span class="mini-info">
                {{route.schedule}}
              </span>
            </div>
            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_activebid.svg">
              </span>
              <span class="mini-info important">
                You have 5 trips remaining in your Route Pass.
              </span>
            </div>
          </route-item-additional-info>
        </route-item>
        <i class="icon ion-ios-arrow-right"></i>
      </ion-item>
      <div class="item item-divider"
          ng-if="data.filteredRecentRoutes.length > 0">
        Recently Booked Routes
      </div>
      <ion-item ng-repeat="route in data.filteredRecentRoutes"
                ui-sref="tabs.bookingPickup({
                  routeId: route.id,
                  boardStop:  data.recentRoutesById[route.id].boardStopStopId,
                  alightStop: data.recentRoutesById[route.id].alightStopStopId,
                  sessionId: data.nextSessionId
                })"
                class="item-text-wrap item-icon-right">
        <route-item>
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route | routeStartTime | formatTime:true }}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route | routeEndTime | formatTime:true }}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>

          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_schedule.svg">
              </span>
              <span class="mini-info">
                {{route.schedule}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_activebid.svg">
              </span>
              <span class="mini-info important" ng-if="route.ridesRemaining && route.ridesRemaining > 0">
                You have {{ route.ridesRemaining }} trips remaining in your Route Pass.
              </span>
            </div>
          </route-item-additional-info>
        </route-item>
        <i class="icon ion-ios-arrow-right"></i>
      </ion-item>

      <!-- Available Routes Section -->
      <div class="item item-divider">
        Available Routes
      </div>

      <!-- Available Lite Routes Section -->
      <ion-item ng-repeat="route in data.filteredLiteRoutes"
                ui-sref="tabs.lite-summary({
                  label: route.label,
                })"
                class="item-icon-right">
        <route-item class="lite"
                    ng-class="{'lite-tracked': route.isSubscribed}">
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route.startTime | formatTime}}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route.endTime | formatTime}}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>

          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_schedule.svg">
              </span>
              <span class="mini-info">
                {{route.schedule}}
              </span>
            </div>
          </route-item-additional-info>
        </route-item>
        <i class="icon ion-ios-arrow-right"></i>
      </ion-item>

      <ion-item ng-repeat="route in data.filteredActiveRoutes"
                ui-sref="tabs.bookingPickup({
                  routeId: route.id,
                  sessionId: data.nextSessionId
                })"
                class="item-text-wrap item-icon-right">
        <route-item>
          <route-item-bus-number>
            {{ route.label }}
          </route-item-bus-number>
          <route-item-description>
            {{ route.notes.description }}
          </route-item-description>
          <route-item-start-time>
            {{ route | routeStartTime | formatTime:true }}
          </route-item-start-time>
          <route-item-start-location>
            {{ route.from }}
          </route-item-start-location>
          <route-item-end-time>
            {{ route | routeEndTime | formatTime:true }}
          </route-item-end-time>
          <route-item-end-location>
            {{ route.to }}
          </route-item-end-location>

          <route-item-additional-info>
            <company-info-broker company-id="route.transportCompanyId"
                                  company="companyInfo">
            </company-info-broker>
            <div class="icon-and-schedule">
              <span class="icon-span company-logo">
                <img class="mini-icon" ng-src="{{route.transportCompanyId | companyLogo}}">
              </span>
              <span class="mini-info">
                {{companyInfo.name}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_schedule.svg">
              </span>
              <span class="mini-info">
                {{route.schedule}}
              </span>
            </div>

            <div class="icon-and-schedule">
              <span class="icon-span">
                <img class="mini-icon" src="img/icon_kickstarter_activebid.svg">
              </span>
              <span class="mini-info important" ng-if="route.ridesRemaining && route.ridesRemaining > 0">
                You have {{ route.ridesRemaining }} trips remaining in your Route Pass.
              </span>
            </div>
          </route-item-additional-info>
        </route-item>
        <i class="icon ion-ios-arrow-right"></i>
      </ion-item>

      <p ng-if="data.filteredActiveRoutes.length === 0 && data.filteredLiteRoutes.length === 0
        && data.filterText" class="not-found-message text-center">
          Sorry, we could not find any routes matching "{{data.filterText}}".
      </p>
    </ion-content>
  </ion-content>
</ion-view>
