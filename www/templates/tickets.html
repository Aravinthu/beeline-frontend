<ion-view class="tickets" view-title="Tickets">
  <ion-content>
    <ion-refresher ng-if="error"
                   pulling-text="Pull to refresh..."
                   on-refresh="refreshTickets(true)">
    </ion-refresher>

    <div class="item item-text-wrap no-tickets" ng-if="!user">
      <div class="item item-text-wrap" ng-if="error">
        <i class="icon ion-alert-circled"></i>
        There was a problem fetching your tickets from the server.
        Please try again later.
      </div>
      <img src="./img/bgTickets.svg">
      <h2>You are not logged in</h2>
      <p>Log in to see your upcoming trips!</p>
      <button class="primary-button" on-tap="logIn()">
        Log In
      </button>
    </div>

    <!-- if no tickets -->
    <div class="item item-text-wrap no-tickets"
         ng-if="user &&
                tickets.today.length === 0 &&
                tickets.soon.length === 0">
      <div class="item item-text-wrap" ng-if="error">
        <i class="icon ion-alert-circled"></i>
        There was a problem fetching your tickets from the server.
        Please try again later.
      </div>

      <img src="./img/bgTickets.svg">
      <h2>No upcoming trips</h2>
      <p>Your tickets will appear here when you book a trip!</p>
      <button class="primary-button" ui-sref="tabs.routes">
        Search For Routes
      </button>
    </div>

    <!-- if there are tickets -->
    <div class="list"
         ng-if="user &&
                tickets.today.length > 0 ||
                tickets.soon.length > 0">
      <div class="item item-text-wrap" ng-if="error">
        <i class="icon ion-alert-circled"></i>
        There was a problem fetching your tickets from the server.
        Please try again later.
      </div>

      <div ng-if="tickets.today.length > 0"
           class="item item-divider">Today's Trips</div>
      <a ng-if="tickets.today.length > 0"
         class="item item-icon-right"
         ng-repeat="ticket in tickets.today"
         ui-sref="tabs.ticket-detail({ ticketId: ticket.id })">
        <span class="date">{{ ticket.boardStop.time | date:'d MMM y' }}</span> {{ ticket.boardStop.time | date:'h:mm a' }}
        <i class="icon ion-chevron-right icon-accessory"></i>
      </a>
      <div ng-if="tickets.soon.length > 0"
           class="item item-divider">Upcoming Trips</div>
      <a ng-if="tickets.soon.length > 0"
         class="item item-icon-right"
         ng-repeat="ticket in tickets.soon"
         ui-sref="tabs.ticket-detail({ ticketId: ticket.id })">
        <span class="date">{{ ticket.boardStop.time | date:'d MMM y' }}</span> {{ ticket.boardStop.time | date:'h:mm a' }}
        <i class="icon ion-chevron-right icon-accessory"></i>
      </a>
    </div>
  </ion-content>
</ion-view>
